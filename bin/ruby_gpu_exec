#!/bin/bash

if [ -e $2.out]
  >&2 echo $2.out File already exists. Protectively reject submitting job
  exit 1
fi

touch $2.out

cat << HERE | sbatch
#!/bin/bash

#SBATCH --job-name=batch-kaidong
#SBATCH --output=$2.out
#SBATCH --ntasks=2
#SBATCH --nodes=1
#SBATCH --partition=gpu
#SBATCH --gres=gpu:1
#SBATCH --constraint="gtx1080ti"
##SBATCH --constraint="rtx2080"

module load singularity || true

set -xe
ruby -s $1 ${@:3}
HERE
